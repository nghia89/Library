@model IPagedList<BiTech.Library.Models.BookView>
@using PagedList.Mvc;
@using PagedList;
@*@model BiTech.Library.Models.ListBooksModel*@
@{
    ViewBag.Title = "Index";
    var listSach = ViewBag.ListSach;
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
    var TLS = (IEnumerable<BiTech.Library.DTO.TheLoaiSach>)ViewBag.theLoaiSach;
    var TG = (IEnumerable<BiTech.Library.DTO.TacGia>)ViewBag.tacGia;
    var NXB = (IEnumerable<BiTech.Library.DTO.NhaXuatBan>)ViewBag.NXB;

}

<div class="Title">Danh Sách</div>

<div class="clearfix">
    <h4 class="alert-danger">@TempData["alert"]</h4>
    <div class="clearfix pb-2 pl-2 row">
        <div class="clearfix pb-2 pl-2">
            @Html.ActionLink("Thêm mới", "Create", "Sach", new { @class = "btn btn-sm btn-primary ml-2" })
            @Html.ActionLink("Thêm từ file Excel", "ImportFromExcel", "Sach", new { @class = "btn btn-sm btn-primary ml-2" })
            @Html.ActionLink("Thêm từ Marc21", "ImportMarc", "Marc", null, new { @class = "btn btn-sm btn-primary ml-2" })
            @Html.ActionLink("Xuất Marc21", "Index", "ExportMarc", null, new { @class = "btn btn-sm btn-primary ml-2" })
            <a class="btn btn-sm btn-danger ml-2" href="~/Tempaltes/Sach.xlsx">Mẫu Excel</a>
        </div>
    </div>

    <form action="/Sach/Index" class="clearfix">

        <div class="col-md-4 col-sm-12  form-group pull-right px-2 mt-1 mb-1">
            <select class="form-control form-control-sm" name="TenNXB" id="">
                <option value="">--Nhà xuất bản--</option>
                @foreach (var nxb in NXB)
                {
                    <option value="@nxb.Id">@nxb.Ten</option>
                }
            </select>
        </div>
        <div class="col-md-4 col-sm-12  form-group pull-right px-2 mt-1 mb-1">
            <select class="form-control form-control-sm" name="TenTacGia" id="ddlCategorySearch">
                <option value="">--Tác giả--</option>
                @foreach (var tg in TG)
                {
                    <option value="@tg.Id">@tg.TenTacGia</option>
                }
            </select>
        </div>
        <div class="col-md-4 col-sm-12  form-group pull-right px-2 mt-1 mb-1">
            <select class="form-control form-control-sm" name="TheLoaiSach" id="ddlCategorySearch">
                <option value="">--Thể loại sách--</option>
                @foreach (var tls in TLS)
                {
                    <option value="@tls.Id">@tls.TenTheLoai</option>
                }
            </select>
        </div>
        <div class="input-group col-md-12 col-sm-12 col-xs-12 form-group pull-right input-group-sm px-2 mt-1 mb-1">
            <input type="text" id="txtKeyword" name="Keyword" class="form-control form-control-sm" placeholder="Tên sách...">
            <div class="input-group-append">
                <button class="btn btn-primary btn-sm" id="btnSearch" type="submit">
                    <i class="fa fa-search"></i>
                </button>
            </div>
        </div>

    </form>
    @{int i = 1;}

    <div class="book_content clearfix">

        @foreach (var item in Model)
        {
            <div Class="book_box_v3 clearfix">
                <div class="container-box-window clearfix">
                    <div class="top">
                        <div class="title">@item.SachDTO.TenSach</div>
                    </div>

                    <div class="content-box-window clearfix">
                        <div class="book_image">
                            <img src="@item.SachDTO.LinkBiaSach"
                                 onerror="this.src = '/Assets/Images/DefaultBookCover.jpg';">
                        </div>
                        <div class="book_cell_information clearfix width_left">
                            <div class="book_information clearfix">
                                <span>
                                    <span class="book_title_information">Mã kiểm soát:</span>
                                    @item.SachDTO.MaKiemSoat
                                </span>
                            </div>
                            <div class="book_information clearfix">
                                <span>
                                    <span class="book_title_information">Tác giả:</span>
                                    @item.Ten_TacGia
                                </span>
                            </div>
                            <div class="book_information clearfix">
                                <span>
                                    <span class="book_title_information">ISBN:</span>
                                    @item.SachDTO.ISBN
                                </span>
                            </div>
                            <div class="book_information clearfix">
                                <span>
                                    <span class="book_title_information">Ngôn ngữ:</span>
                                    @item.Ten_NgonNgu
                                </span>
                            </div>
                        </div>
                        <div class="book_cell_information clearfix width_right">
                            <div class="book_information clearfix">
                                <span>
                                    <span class="book_title_information">Năm xuất bản:</span>
                                    @item.SachDTO.NamXuatBan
                                </span>
                            </div>
                            <div class="book_information clearfix">
                                <span>
                                    <span class="book_title_information">Tổng số sách:</span>
                                    @item.SachDTO.SoLuongTong
                                </span>
                            </div>
                            <div class="book_information clearfix">
                                <span>
                                    <span class="book_title_information">Còn lại:</span>
                                    @item.SachDTO.SoLuongConLai
                                </span>
                            </div>
                            <a href="@Url.Action("Edit", new { id=item.SachDTO.Id })"
                               class="btn btn-primary btn-sm"
                               style="position: absolute; bottom: 10px; right: 10px; font-size: 15px">Xem</a>
                        </div>
                    </div>
                </div>
            </div>
            { i++; }
        }
    </div>
    <div class="clearfix"></div>
    <br />
    @if (@ViewBag.number > 30)
    {
        @Html.PagedListPager(Model, page => Url.Action("Index", new { page }), PagedListRenderOptions.ClassicPlusFirstAndLast)
    }

</div>
@*<button value="Xoa" onclick="XoaCauHoi()" />*@
<script src="~/bower_components/sweetalert/dist/sweetalert.min.js"></script>

@section scripts{
    <script>
                    $(document).keypress(function (e) {
                        if (e.which == 13) {
                            $("#btnSearch").submit();
                        }
                    });
    </script>
    <script src="~/Scripts/AutocompleteSach.js"></script>
    <script>
        function XoaCauHoi() {
            swal({
                title: "Are you sure?",
                text: "You will not be able to recover this imaginary file!",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-danger",
                confirmButtonText: "Yes, delete it!",
                cancelButtonText: "No, cancel plx!",
                closeOnConfirm: false,
                closeOnCancel: false
            },
                function (isConfirm) {
                    if (isConfirm) {
                        swal("Deleted!", "Your imaginary file has been deleted.", "success");
                    } else {
                        swal("Cancelled", "Your imaginary file is safe :)", "error");
                    }
                });
        }
    </script>
}